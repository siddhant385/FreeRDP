name: Setup RDP on Windows

on: [push, pull_request]

jobs:
  setup-rdp:
    runs-on: windows-latest

    steps:
    - name: Check out repository
      uses: actions/checkout@v2

    - name: Install RDP tools
      run: |
        # Install Chocolatey
        Set-ExecutionPolicy Bypass -Scope Process -Force; 
        [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; 
        iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))

        # Install xfreerdp
        choco install freerdp -y

    - name: Enable RDP
      run: |
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name 'fDenyTSConnections' -Value 0
        Enable-NetFirewallRule -DisplayGroup 'Remote Desktop'

    - name: Set up RDP user
      run: |
        $username = "rdpuser"
        $password = "SecurePassword123!"  # Replace with a secure password or use secrets
        net user /add $username $password
        net localgroup "Remote Desktop Users" /add $username

    - name: Display RDP connection information
      run: |
        $ip = (Invoke-RestMethod -Uri 'http://ipinfo.io/json').ip
        Write-Host "Connect using the following credentials:"
        Write-Host "IP Address: $ip"
        Write-Host "Username: rdpuser"
        Write-Host "Password: SecurePassword123!"
